#***************************************************************************   
#       user configuration
# set mpi = yes for the parallel version
# set debug = yes to debug 
DEBUG ?= no	

MPI ?= no 
MPICC = /usr/local/bin/mpic++
#
# set impute = yes for mask/imputation feature
IMPUTE ?= yes
#
# end user configuration;
#***************************************************************************    

#SHELL = /bin/sh

CC = g++

ifeq ($(strip $(MPI)), yes)
    CFLAGS += -DMPI_ENABLED
    CC = $(MPICC)
endif

ifeq ($(strip $(IMPUTE)), yes)
    CFLAGS += -DIMPUTATION ##-DOUTPUT_MASKED_GENOTYPE##-DPOWER
endif

ifeq ($(strip $(DEBUG)), yes)
    CFLAGS += -ggdb -DDEBUG
else
    CFLAGS += -O2
endif

CFLAGS += -Wall -m64 -fno-math-errno  

STATICLIBS += /usr/local/lib/libgsl.a /usr/local/lib/libgslcblas.a 

CPPFLAGS = CFLAGS

LIBS += -lm #-lgsl -lgslcblas  

OBJS = control.o fpmath.o indiv.o diploid.o haploid.o model.o param.o 

SRCS = fp.cpp control.cpp fpmath.cpp indiv.cpp diploid.cpp haploid.cpp model.cpp param.cpp


all:  fp $(OBJS)

.cpp.o : ; 	$(CC) $(CFLAGS) -c $<  			

## static link to gsl libs.  		
## note it's crutial to use -static-libgcc instead of static; 
fp: fp.o $(OBJS); $(CC) -static-libgcc $(CFLAGS) $(OBJS) fp.o $(STATICLIBS) $(LIBS) -o bimbam	
#fp: fp.o $(OBJS); $(CC) -static-libgcc $(CFLAGS) $(OBJS) fp.o $(LIBS) -o bimbam	
#fp: fp.o $(OBJS); $(CC) $(CFLAGS) $(OBJS) fp.o $(STATICLIBS) $(LIBS) -o bimbam	

# the following dependence generated by make showdep	
fp.o: fp.h fpmath.h control.h model.h diploid.h indiv.h haploid.h param.h
control.o:  control.h fpmath.h model.h diploid.h fp.h indiv.h haploid.h param.h
fpmath.o: fpmath.h
indiv.o: indiv.h fpmath.h
diploid.o: indiv.h fp.h fpmath.h diploid.h model.h haploid.h param.h
haploid.o: haploid.h fp.h fpmath.h indiv.h model.h diploid.h param.h
model.o: model.h diploid.h fp.h fpmath.h indiv.h haploid.h param.h control.h  
param.o: param.h diploid.h fp.h fpmath.h indiv.h model.h haploid.h

showdep: 	
		@$(CC) -MM $(SRCS)
 
clean: 
		rm -f *.o
		
